<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Further waves | Case Study -1: An introduction to the Emulatorr package</title>
  <meta name="description" content="An easy guide to the main functionalities of the Emulatorr package" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Further waves | Case Study -1: An introduction to the Emulatorr package" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An easy guide to the main functionalities of the Emulatorr package" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Further waves | Case Study -1: An introduction to the Emulatorr package" />
  
  <meta name="twitter:description" content="An easy guide to the main functionalities of the Emulatorr package" />
  

<meta name="author" content="Danny Scarponi" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="point-generation.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script language="javascript"> 
    function toggle(id) {
        var ele = document.getElementById("toggleText" + id);
        var text = document.getElementById("displayText" + id);
        var buttonText = text.innerHTML.replace("Show ", "");
        buttonText = buttonText.replace("Hide ", "");
        if(ele.style.display == "block") {
            ele.style.display = "none";
            text.innerHTML = "Show " + buttonText;
        } else {
            ele.style.display = "block";
            text.innerHTML = "Hide " + buttonText;
        }
    } 
</script>

<script language="javascript">
    function openCode(evt, codeName, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent" + id);
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks" + id);
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(codeName).style.display = "block";
        evt.currentTarget.className += " active";
    }
</script>

<script language="javascript">
    function hide(id){
        document.getElementById(id).style.display = "none";
    }
</script>
</script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#history-matching"><i class="fa fa-check"></i><b>1.1</b> History Matching</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#emulators"><i class="fa fa-check"></i><b>1.2</b> Emulators</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-the-model.html"><a href="introduction-to-the-model.html"><i class="fa fa-check"></i><b>2</b> Introduction to the model</a></li>
<li class="chapter" data-level="3" data-path="perfoming-a-full-wave-of-emulation-and-history-matching.html"><a href="perfoming-a-full-wave-of-emulation-and-history-matching.html"><i class="fa fa-check"></i><b>3</b> Perfoming a full wave of emulation and history matching</a></li>
<li class="chapter" data-level="4" data-path="constructing-the-emulators.html"><a href="constructing-the-emulators.html"><i class="fa fa-check"></i><b>4</b> Constructing the emulators</a><ul>
<li class="chapter" data-level="4.1" data-path="constructing-the-emulators.html"><a href="constructing-the-emulators.html#background-the-structure-of-an-emulator"><i class="fa fa-check"></i><b>4.1</b> Background: the structure of an emulator</a></li>
<li class="chapter" data-level="4.2" data-path="constructing-the-emulators.html"><a href="constructing-the-emulators.html#constructing-the-emulators-step-by-step"><i class="fa fa-check"></i><b>4.2</b> Constructing the emulators step by step</a><ul>
<li class="chapter" data-level="4.2.1" data-path="constructing-the-emulators.html"><a href="constructing-the-emulators.html#step-1"><i class="fa fa-check"></i><b>4.2.1</b> Step 1</a></li>
<li class="chapter" data-level="4.2.2" data-path="constructing-the-emulators.html"><a href="constructing-the-emulators.html#step-2"><i class="fa fa-check"></i><b>4.2.2</b> Step 2</a></li>
<li class="chapter" data-level="4.2.3" data-path="constructing-the-emulators.html"><a href="constructing-the-emulators.html#step-3"><i class="fa fa-check"></i><b>4.2.3</b> Step 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="emulator-diagnostics.html"><a href="emulator-diagnostics.html"><i class="fa fa-check"></i><b>5</b> Emulator diagnostics</a><ul>
<li class="chapter" data-level="5.1" data-path="emulator-diagnostics.html"><a href="emulator-diagnostics.html#background-the-implausibility-measure"><i class="fa fa-check"></i><b>5.1</b> Background: the implausibility measure</a></li>
<li class="chapter" data-level="5.2" data-path="emulator-diagnostics.html"><a href="emulator-diagnostics.html#implausibility-visualisations"><i class="fa fa-check"></i><b>5.2</b> Implausibility visualisations</a></li>
<li class="chapter" data-level="5.3" data-path="emulator-diagnostics.html"><a href="emulator-diagnostics.html#three-emulator-diagnostics"><i class="fa fa-check"></i><b>5.3</b> Three emulator diagnostics</a></li>
<li class="chapter" data-level="5.4" data-path="emulator-diagnostics.html"><a href="emulator-diagnostics.html#parameter-sets-failing-diagnostics"><i class="fa fa-check"></i><b>5.4</b> Parameter sets failing diagnostics</a><ul>
<li class="chapter" data-level="5.4.1" data-path="emulator-diagnostics.html"><a href="emulator-diagnostics.html#visualisation"><i class="fa fa-check"></i><b>5.4.1</b> Visualisation</a></li>
<li class="chapter" data-level="5.4.2" data-path="emulator-diagnostics.html"><a href="emulator-diagnostics.html#space-removed-function"><i class="fa fa-check"></i><b>5.4.2</b> Space removed function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="point-generation.html"><a href="point-generation.html"><i class="fa fa-check"></i><b>6</b> Point Generation</a><ul>
<li class="chapter" data-level="6.1" data-path="point-generation.html"><a href="point-generation.html#generating-sets-of-parameters-for-the-next-wave"><i class="fa fa-check"></i><b>6.1</b> Generating sets of parameters for the next wave</a></li>
<li class="chapter" data-level="6.2" data-path="point-generation.html"><a href="point-generation.html#comparing-next-and-old-parameter-sets"><i class="fa fa-check"></i><b>6.2</b> Comparing next and old parameter sets</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="further-waves.html"><a href="further-waves.html"><i class="fa fa-check"></i><b>7</b> Further waves</a><ul>
<li class="chapter" data-level="7.1" data-path="further-waves.html"><a href="further-waves.html#next-wave-wave-1"><i class="fa fa-check"></i><b>7.1</b> Next wave: wave 1</a><ul>
<li class="chapter" data-level="7.1.1" data-path="further-waves.html"><a href="further-waves.html#training-wave-1-emulators"><i class="fa fa-check"></i><b>7.1.1</b> Training wave 1 emulators</a></li>
<li class="chapter" data-level="7.1.2" data-path="further-waves.html"><a href="further-waves.html#evaluating-implausibility-across-all-waves"><i class="fa fa-check"></i><b>7.1.2</b> Evaluating implausibility across all waves</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="further-waves.html"><a href="further-waves.html#next-wave-wave-2"><i class="fa fa-check"></i><b>7.2</b> Next wave: wave 2</a><ul>
<li class="chapter" data-level="7.2.1" data-path="further-waves.html"><a href="further-waves.html#training-wave-2-emulators"><i class="fa fa-check"></i><b>7.2.1</b> Training wave 2 emulators</a></li>
<li class="chapter" data-level="7.2.2" data-path="further-waves.html"><a href="further-waves.html#evaluating-implausibility-across-all-waves-1"><i class="fa fa-check"></i><b>7.2.2</b> Evaluating implausibility across all waves</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Case Study -1: An introduction to the Emulatorr package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="further-waves" class="section level1">
<h1><span class="header-section-number">7</span> Further waves</h1>
<p>We follow the same procedure for subsequent waves, with a couple of caveats.</p>
<div id="next-wave-wave-1" class="section level2">
<h2><span class="header-section-number">7.1</span> Next wave: wave 1</h2>
<div id="training-wave-1-emulators" class="section level3">
<h3><span class="header-section-number">7.1.1</span> Training wave 1 emulators</h3>
<p>First of all we train a new set of emulators, in the same way we did for <code>ems0</code>:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">sampling &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">nrow</span>(wave1), <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb32-2" title="2">train1 &lt;-<span class="st"> </span>wave1[sampling,<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>]</a>
<a class="sourceLine" id="cb32-3" title="3">valid1 &lt;-<span class="st"> </span>wave1[<span class="op">!</span><span class="kw">seq_along</span>(wave1[,<span class="dv">1</span>])<span class="op">%in%</span>sampling,<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>]</a>
<a class="sourceLine" id="cb32-4" title="4">new_ranges &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="kw">names</span>(ranges), <span class="op">~</span><span class="kw">c</span>(<span class="kw">min</span>(wave1[,.]), <span class="kw">max</span>(wave1[,.]))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">setNames</span>(<span class="kw">names</span>(ranges))</a>
<a class="sourceLine" id="cb32-5" title="5">ems1 &lt;-<span class="st"> </span><span class="kw">emulator_from_data</span>(train1, output_names, new_ranges, <span class="dt">quadratic =</span> T)</a>
<a class="sourceLine" id="cb32-6" title="6">deltas &lt;-<span class="st"> </span><span class="kw">apply</span>(wave1[,<span class="dv">10</span><span class="op">:</span><span class="dv">14</span>], <span class="dv">2</span>, mean)<span class="op">/</span><span class="kw">map_dbl</span>(ems1, <span class="op">~</span>.<span class="op">$</span>u_sigma)</a>
<a class="sourceLine" id="cb32-7" title="7">ems1 &lt;-<span class="st"> </span><span class="kw">emulator_from_data</span>(train1, output_names, new_ranges, <span class="dt">deltas =</span> deltas, <span class="dt">quadratic =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb32-8" title="8"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(ems1)) ems1[[i]]<span class="op">$</span>output_name &lt;-<span class="st"> </span>output_names[i]</a>
<a class="sourceLine" id="cb32-9" title="9">ems1_adjusted &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="kw">seq_along</span>(ems1), <span class="op">~</span>ems1[[.]]<span class="op">$</span><span class="kw">adjust</span>(train1, output_names[[.]]))</a>
<a class="sourceLine" id="cb32-10" title="10"><span class="kw">names</span>(ems1_adjusted) &lt;-<span class="st"> </span>output_names</a></code></pre></div>
</div>
<div id="evaluating-implausibility-across-all-waves" class="section level3">
<h3><span class="header-section-number">7.1.2</span> Evaluating implausibility across all waves</h3>
<p>We can apply diagnostics to this as before, using <code>valid1</code> as the validation set. Assuming the diagnostics are acceptable, we then proceed to consider implausibility - however, we need the implausibility over the whole input space, and the new emulators have only been trained on a subset thereof. We must therefore consider implausibility across all waves, rather than just the wave under consideration at the time.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1">all_waves &lt;-<span class="st"> </span><span class="kw">c</span>(ems0_adjusted, ems1_adjusted)</a>
<a class="sourceLine" id="cb33-2" title="2">all_targets &lt;-<span class="st"> </span><span class="kw">c</span>(targets, targets)</a>
<a class="sourceLine" id="cb33-3" title="3"><span class="kw">emulator_plot</span>(all_waves, <span class="dt">var =</span> <span class="st">&#39;maximp&#39;</span>, <span class="dt">targets =</span> all_targets)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-38-1.png" style="display: block; margin: auto;" /></p>
<p>This may seem an unwieldy way to approach this (and it is, at present); however, it is important to remember that the number of emulators at each wave may not be the same; for example, if we have had to remove an output at wave 1, then the targets would be accordingly changed. In this illustration case, we did not have to worry about doing so since we have assumed that all targets can be emulated.</p>
<p>If we compare the implausibility plot we just obtained with the implausibility plot from the previous wave, we see that the red area has increased significantly: this shows that wave 1 is shrinking down the non-implausible space, exactly as we expected.</p>
<p>The remainder of the analysis proceeds much as in the first wave. In generating new parameter sets, we would of course provide all_waves to the point generation function.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1">new_new_points &lt;-<span class="st"> </span><span class="kw">generate_new_runs</span>(all_waves, ranges, <span class="dt">n_points =</span> <span class="dv">120</span>, <span class="dt">z =</span> all_targets)</a>
<a class="sourceLine" id="cb34-2" title="2"><span class="co">#&gt; 293 non-implausible points generated. Applying V-optimality...</span></a>
<a class="sourceLine" id="cb34-3" title="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb34-4" title="4"><span class="kw">plot</span>(new_new_points, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-39-1.png" style="display: block; margin: auto;" /></p>
<p>We can compare the distribution of parameter sets at the end of <code>wave0</code> with that of parameter sets at the end of <code>wave1</code>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="kw">wave_points</span>(<span class="kw">list</span>(wave1, new_new_points), <span class="dt">in_names =</span> <span class="kw">names</span>(ranges))</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-40-1.png" style="display: block; margin: auto;" /></p>
<p>The last step is to create <code>wave2</code>, that will be used to train
<code>wave2</code> emulators.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1">next_next_wave &lt;-<span class="st"> </span><span class="kw">getOutputs</span>(new_new_points, <span class="kw">seq</span>(<span class="dv">10</span>,<span class="dv">30</span>,<span class="dt">by=</span><span class="dv">5</span>))</a>
<a class="sourceLine" id="cb36-2" title="2">wave2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">cbind</span>(new_new_points,next_next_wave))<span class="op">%&gt;%</span><span class="st">   </span></a>
<a class="sourceLine" id="cb36-3" title="3"><span class="st">  </span><span class="kw">setNames</span>(<span class="kw">c</span>(<span class="kw">names</span>(ranges),<span class="kw">paste0</span>(<span class="st">&quot;I&quot;</span>,<span class="kw">seq</span>(<span class="dv">10</span>,<span class="dv">30</span>,<span class="dt">by=</span><span class="dv">5</span>)),   <span class="kw">paste0</span>(<span class="st">&quot;EV&quot;</span>,<span class="kw">seq</span>(<span class="dv">10</span>,<span class="dv">30</span>,<span class="dt">by=</span><span class="dv">5</span>))))</a></code></pre></div>
<p>Through the <code>simulator_plot</code> function we see how much better the <code>wave2</code> parameter sets perform compared to the original <code>wave1</code> parameter sets.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1">all_points &lt;-<span class="st"> </span><span class="kw">list</span>(wave1[<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>], wave2[<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>])</a>
<a class="sourceLine" id="cb37-2" title="2"><span class="kw">simulator_plot</span>(all_points, targets)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-42-1.png" style="display: block; margin: auto;" /></p>
<p>Next waves of the process can be produced simply repeating all the steps in this section.</p>
</div>
</div>
<div id="next-wave-wave-2" class="section level2">
<h2><span class="header-section-number">7.2</span> Next wave: wave 2</h2>
<div id="training-wave-2-emulators" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Training wave 2 emulators</h3>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1">sampling &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">nrow</span>(wave2), <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb38-2" title="2">train2 &lt;-<span class="st"> </span>wave2[sampling,<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>]</a>
<a class="sourceLine" id="cb38-3" title="3">valid2 &lt;-<span class="st"> </span>wave2[<span class="op">!</span><span class="kw">seq_along</span>(wave2[,<span class="dv">1</span>])<span class="op">%in%</span>sampling,<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>]</a>
<a class="sourceLine" id="cb38-4" title="4">new_new_ranges &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="kw">names</span>(ranges), <span class="op">~</span><span class="kw">c</span>(<span class="kw">min</span>(wave2[,.]), <span class="kw">max</span>(wave2[,.]))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">setNames</span>(<span class="kw">names</span>(ranges))</a>
<a class="sourceLine" id="cb38-5" title="5">ems2 &lt;-<span class="st"> </span><span class="kw">emulator_from_data</span>(train2, output_names, new_new_ranges, <span class="dt">quadratic =</span> T)</a>
<a class="sourceLine" id="cb38-6" title="6">deltas &lt;-<span class="st"> </span><span class="kw">apply</span>(wave2[,<span class="dv">10</span><span class="op">:</span><span class="dv">14</span>], <span class="dv">2</span>, mean)<span class="op">/</span><span class="kw">map_dbl</span>(ems2, <span class="op">~</span>.<span class="op">$</span>u_sigma)</a>
<a class="sourceLine" id="cb38-7" title="7">ems2 &lt;-<span class="st"> </span><span class="kw">emulator_from_data</span>(train2, output_names, new_new_ranges, <span class="dt">deltas =</span> deltas, <span class="dt">quadratic =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb38-8" title="8"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(ems2)) ems2[[i]]<span class="op">$</span>output_name &lt;-<span class="st"> </span>output_names[i]</a>
<a class="sourceLine" id="cb38-9" title="9">ems2_adjusted &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="kw">seq_along</span>(ems2), <span class="op">~</span>ems2[[.]]<span class="op">$</span><span class="kw">adjust</span>(train2, output_names[[.]]))</a>
<a class="sourceLine" id="cb38-10" title="10"><span class="kw">names</span>(ems2_adjusted) &lt;-<span class="st"> </span>output_names</a></code></pre></div>
</div>
<div id="evaluating-implausibility-across-all-waves-1" class="section level3">
<h3><span class="header-section-number">7.2.2</span> Evaluating implausibility across all waves</h3>
<p>As before, we need to consider implausibility across all waves, rather than just the wave under consideration at the time.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1">all_waves &lt;-<span class="st"> </span><span class="kw">c</span>(ems0_adjusted, ems1_adjusted, ems2_adjusted)</a>
<a class="sourceLine" id="cb39-2" title="2">all_targets &lt;-<span class="st"> </span><span class="kw">c</span>(targets, targets, targets)</a>
<a class="sourceLine" id="cb39-3" title="3"><span class="kw">emulator_plot</span>(all_waves, <span class="dt">var =</span> <span class="st">&#39;maximp&#39;</span>, <span class="dt">targets =</span> all_targets)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-44-1.png" style="display: block; margin: auto;" /></p>
<p>To generate new parameter sets:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1">new_new_new_points &lt;-<span class="st"> </span><span class="kw">generate_new_runs</span>(all_waves, ranges, <span class="dt">n_points =</span> <span class="dv">120</span>, <span class="dt">z =</span> all_targets)</a>
<a class="sourceLine" id="cb40-2" title="2"><span class="co">#&gt; 228 non-implausible points generated. Applying V-optimality...</span></a>
<a class="sourceLine" id="cb40-3" title="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb40-4" title="4"><span class="kw">plot</span>(new_new_new_points, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-45-1.png" style="display: block; margin: auto;" /></p>
<p>We now create <code>wave3</code>:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1">next_next_next_wave &lt;-<span class="st"> </span><span class="kw">getOutputs</span>(new_new_new_points, <span class="kw">seq</span>(<span class="dv">10</span>,<span class="dv">30</span>,<span class="dt">by=</span><span class="dv">5</span>))</a>
<a class="sourceLine" id="cb41-2" title="2">wave3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">cbind</span>(new_new_new_points,next_next_next_wave))<span class="op">%&gt;%</span><span class="st">   </span></a>
<a class="sourceLine" id="cb41-3" title="3"><span class="st">  </span><span class="kw">setNames</span>(<span class="kw">c</span>(<span class="kw">names</span>(ranges),<span class="kw">paste0</span>(<span class="st">&quot;I&quot;</span>,<span class="kw">seq</span>(<span class="dv">10</span>,<span class="dv">30</span>,<span class="dt">by=</span><span class="dv">5</span>)),   <span class="kw">paste0</span>(<span class="st">&quot;EV&quot;</span>,<span class="kw">seq</span>(<span class="dv">10</span>,<span class="dv">30</span>,<span class="dt">by=</span><span class="dv">5</span>))))</a></code></pre></div>
<p>Through the <code>simulator_plot</code> function we check how much better the <code>wave3</code> parameter sets perform compared to the original <code>wave2</code> parameter sets.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1">all_points &lt;-<span class="st"> </span><span class="kw">list</span>(wave2[<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>], wave3[<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>])</a>
<a class="sourceLine" id="cb42-2" title="2"><span class="kw">simulator_plot</span>(all_points, targets)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-47-1.png" style="display: block; margin: auto;" /></p>
<p>The graph does not show a clear improvement in the performance of <code>wave3</code> parameter sets compared to that of <code>wave2</code> parameter sets. To understand the reason behind this, let us compare the variability of the outputs we are emulating with the emulators uncertainty. Below we show the ensemble variability and the uncertainty for <code>ems0</code> and <code>ems2</code> for each of the outputs.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1">targets<span class="op">$</span>I10<span class="op">$</span>sigma</a>
<a class="sourceLine" id="cb43-2" title="2"><span class="co">#&gt; [1] 25.27</span></a>
<a class="sourceLine" id="cb43-3" title="3">targets<span class="op">$</span>I15<span class="op">$</span>sigma</a>
<a class="sourceLine" id="cb43-4" title="4"><span class="co">#&gt; [1] 40.99</span></a>
<a class="sourceLine" id="cb43-5" title="5">targets<span class="op">$</span>I20<span class="op">$</span>sigma</a>
<a class="sourceLine" id="cb43-6" title="6"><span class="co">#&gt; [1] 46.48</span></a>
<a class="sourceLine" id="cb43-7" title="7">targets<span class="op">$</span>I25<span class="op">$</span>sigma</a>
<a class="sourceLine" id="cb43-8" title="8"><span class="co">#&gt; [1] 43.98</span></a>
<a class="sourceLine" id="cb43-9" title="9">targets<span class="op">$</span>I30<span class="op">$</span>sigma</a>
<a class="sourceLine" id="cb43-10" title="10"><span class="co">#&gt; [1] 40.3</span></a>
<a class="sourceLine" id="cb43-11" title="11">sigmas0 &lt;-<span class="st"> </span><span class="kw">map_dbl</span>(ems0, <span class="op">~</span>.<span class="op">$</span>u_sigma)</a>
<a class="sourceLine" id="cb43-12" title="12">sigmas0</a>
<a class="sourceLine" id="cb43-13" title="13"><span class="co">#&gt;      I10      I15      I20      I25      I30 </span></a>
<a class="sourceLine" id="cb43-14" title="14"><span class="co">#&gt; 25.02941 39.90951 46.96881 50.12662 52.34127</span></a>
<a class="sourceLine" id="cb43-15" title="15">sigmas2 &lt;-<span class="st"> </span><span class="kw">map_dbl</span>(ems2, <span class="op">~</span>.<span class="op">$</span>u_sigma)</a>
<a class="sourceLine" id="cb43-16" title="16">sigmas2</a>
<a class="sourceLine" id="cb43-17" title="17"><span class="co">#&gt;       I10       I15       I20       I25       I30 </span></a>
<a class="sourceLine" id="cb43-18" title="18"><span class="co">#&gt;  9.607539 16.217742 18.393964 16.282659 14.902990</span></a></code></pre></div>
<p>We see that while <code>ems0</code> uncertainties (<code>sigmas0</code>) are similar or larger than the ensemble variabilities, <code>ems2</code> uncertainties (<code>sigmas2</code>) are smaller than the ensemble variabilities. Since the emulators variance is smaller than the uncertainty inherent to the model, the nonimplausible
space already contains acceptable matches and is unlikely to
decrease in size in the next iteration.
For this reason, we conclude here the iterating process and therefore the tutorial. Note that if we could revise the uncertainties present in our model and decrease them, we would then be able to perform other waves of the history matching process and shrink the nonimplausible space down further.</p>
<!--
# TJ material



Basically a standard Bookdown template with a few tweaks. New chapters need to be in separate '.Rmd' files, where each file starts with a chapter heading as seen [here](https://bookdown.org/yihui/bookdown/usage.html). In order to use the task and solution blocks in \LaTeX, you must input the order of the files into the `_bookdown.yml` file, and the first file must be called `index.Rmd` e.g.

```
rmd_files:
    html: ['index.Rmd', 'ch1.Rmd']
    latex: ['index.Rmd', 'ch1.Rmd', 'ch_appendix.Rmd']
output_dir: "docs"
```

The `latex:` path above ***must*** have `'ch_appendix.Rmd'` as its last entry. This ensures that the appendix is properly formatted for the solutions to the problems.

You must have the following lines at the start of your `index.Rmd` file:

````
```{r, child = "_setup.Rmd", include = F, purl = F, cache = F}
```
````

There are a couple of useful special blocks. A `task` block, and a `solution` block. These can be used as e.g.

````
```{task}
Here is a task written in **markdown**.
```
````

which renders as:

<div class="panel panel-default"><div class="panel-heading"> Task </div><div class="panel-body"> 
Here is a task written in **markdown**. </div></div>

You can include chunks within the `task` chunk, but you need to use double backticks *within* the chunk, and leave carriage returns around the internal chunk e.g.

````

```{task}

``{r}
x <- 2 + 2
x
``

```

````

which renders as:

<div class="panel panel-default"><div class="panel-heading"> Task </div><div class="panel-body"> 

```r
x <- 2 + 2
x
#> [1] 4
```
 </div></div>

Be careful to have suitable carriage returns around e.g. `enumerate` or `itemize` environments inside the chunk also. For example:

````

```{task}
Here is a list:
1. item 1
2. item 2
```

```` 

will not render nicely. But

````

```{task}
Here is a list:

1. item 1
2. item 2

```

```` 

will:

<div class="panel panel-default"><div class="panel-heading"> Task </div><div class="panel-body"> 
Here is a list:

1. item 1
2. item 2
 </div></div>

The `solution` chunk works in the same way, and the numbers will follow the previous `task` chunk (so you can set tasks without solutions) e.g.

````

```{task}
Add 2 and 2 together
```

```{solution}

``{r}
2 + 2
``

```

````

gives:

<div class="panel panel-default"><div class="panel-heading"> Task </div><div class="panel-body"> 
Add 2 and 2 together </div></div>

<button id="displayTextunnamed-chunk-54" onclick="javascript:toggle('unnamed-chunk-54');">Show Solution</button>

<div id="toggleTextunnamed-chunk-54" style="display: none"><div class="panel panel-default"><div class="panel-heading panel-heading1"> Solution </div><div class="panel-body">

```r
2 + 2
#> [1] 4
```
</div></div></div>

## Additional extensions

### Different task and solution titles

Task and solution boxes can also be given different names using the `title` option e.g.

````

```{task, title = "Question"}
What is the meaning of life, the universe and everything?
```

```{solution, title = "Answer"}
Why 42 of course!
```

````

gives:

<div class="panel panel-default"><div class="panel-heading"> Question </div><div class="panel-body"> 
What is the meaning of life, the universe and everything? </div></div>

<button id="displayTextunnamed-chunk-56" onclick="javascript:toggle('unnamed-chunk-56');">Show Answer</button>

<div id="toggleTextunnamed-chunk-56" style="display: none"><div class="panel panel-default"><div class="panel-heading panel-heading1"> Answer </div><div class="panel-body">
Why 42 of course!</div></div></div>

### Turning tasks and solutions on and off

Sometimes you might want to hide task and/or solution boxes. This can be done with the `renderTask` and `renderSol` chunk options, which can be set globally or locally. For example:

````

```{task, title = "Question"}
Can I set a task and not show the answer?
```

```{solution, title = "Answer", renderSol = FALSE}
Indeed, though you won't see this answer unless `renderSol = TRUE`...
```

````

typesets as:

<div class="panel panel-default"><div class="panel-heading"> Question </div><div class="panel-body"> 
Can I set a task and not show the answer? </div></div>



### Tabbed boxed environments

Originally developed to put base R and `tidyverse` solutions side-by-side, using a `multCode = T` option to the solution box. Here the two tabs are separated by four consecutive hashes: `####`, and the `titles` option gives the tab titles (these can be set globally if preferred) e.g.



````

```{task}
Filter the `iris` data by `Species == "setosa"` and find the mean `Petal.Length`.
```

```{solution, multCode = T, titles = c("Base R", "tidyverse")}

``{r}
## base R solution
mean(iris$Petal.Length[
    iris$Species == "setosa"])
``

####

``{r}
## tidyverse solution
iris %>% 
    filter(Species == "setosa") %>%
    select(Petal.Length) %>%
    summarise(mean = mean(Petal.Length))
``
    
```

````

will typeset to:

<div class="panel panel-default"><div class="panel-heading"> Task </div><div class="panel-body"> 
Filter the `iris` data by `Species == "setosa"` and find the mean `Petal.Length`. </div></div>

<button id="displayTextunnamed-chunk-61" onclick="javascript:toggle('unnamed-chunk-61');">Show Solution</button>

<div id="toggleTextunnamed-chunk-61" style="display: none"><div class="panel panel-default"><div class="panel-heading panel-heading1"> Solution </div><div class="panel-body"><div class="tab"><button class="tablinksunnamed-chunk-61 active" onclick="javascript:openCode(event, 'option1unnamed-chunk-61', 'unnamed-chunk-61');">Base R</button><button class="tablinksunnamed-chunk-61" onclick="javascript:openCode(event, 'option2unnamed-chunk-61', 'unnamed-chunk-61');">tidyverse</button></div><div id="option1unnamed-chunk-61" class="tabcontentunnamed-chunk-61">

```r
## base R solution
mean(iris$Petal.Length[
    iris$Species == "setosa"])
#> [1] 1.462
```
</div><div id="option2unnamed-chunk-61" class="tabcontentunnamed-chunk-61">

```r
## tidyverse solution
iris %>% 
    filter(Species == "setosa") %>%
    select(Petal.Length) %>%
    summarise(mean = mean(Petal.Length))
#>    mean
#> 1 1.462
```
    
</div><script> javascript:hide('option2unnamed-chunk-61') </script></div></div></div>

Note that there is also a `multCode` chunk that does not link to task and solution boxes e.g.

````

```{multCode}

Two options: 

* Option 1

####

Two options:
    
* Option 2

```

````

will typeset to:

<div class="tab"><button class="tablinksunnamed-chunk-62 active" onclick="javascript:openCode(event, 'option1unnamed-chunk-62', 'unnamed-chunk-62');">Option 1</button><button class="tablinksunnamed-chunk-62" onclick="javascript:openCode(event, 'option2unnamed-chunk-62', 'unnamed-chunk-62');">Option 2</button></div><div id="option1unnamed-chunk-62" class="tabcontentunnamed-chunk-62">

Two options: 

* Option 1
</div><div id="option2unnamed-chunk-62" class="tabcontentunnamed-chunk-62">

Two options:
    
* Option 2
</div><script> javascript:hide('option2unnamed-chunk-62') </script>

The `titles` option can be set as before.
-->

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="point-generation.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
